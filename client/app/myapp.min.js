"use strict";!function(){function t(){var t=angular.injector(["ng"]),e=t.get("$http");return e.get("/api/config").then(function(t){})}function e(){angular.element(document).ready(function(){angular.bootstrap(document,["myApp"])})}var n=angular.module("myApp",["ngRoute","satellizer","ngMaterial","ngSanitize"]);n.config(["$routeProvider","$httpProvider","$authProvider",function(t,e,n){t.when("/Home",{templateUrl:"/app/views/home.html",controller:"homeCtrl",controllerAs:"vm"}).when("/Login",{templateUrl:"/app/views/login.html",controller:"loginCtrl",controllerAs:"vm"}).when("/Me",{templateUrl:"/app/views/me.html",controller:"meCtrl",controllerAs:"vm"}).when("/View/:id",{templateUrl:"/app/views/view.html",controller:"viewCtrl",controllerAs:"vm"}).when("/New",{templateUrl:"/app/views/new.html",controller:"newCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/Home"})}]),n.run(["$rootScope","$window","$auth","$http",function(t,e,n,o){if(n.isAuthenticated()&&e.localStorage.currentUser)try{t.currentUser=JSON.parse(e.localStorage.currentUser)}catch(a){}}]),t().then(e)}(),function(){var t=angular.module("myApp");t.controller("topNavCtrl",["$rootScope","$location","$auth","$http","$window",function(t,e,n,o,a){var i=this;i.isAuthenticated=function(){return n.isAuthenticated()},i.goToProfile=function(){e.path("/Me")},i.logout=function(){n.isAuthenticated()&&n.logout().then(function(){t.currentUser=null,a.localStorage.currentUser=null,e.path("/")})},i.getUsername=function(){return i.isAuthenticated()&&t.currentUser.name||""},i.isActive=function(t){return t===e.path()}}]),t.directive("topNav",function(){return{restrict:"E",templateUrl:"/app/views/top-nav.html",controller:"topNavCtrl",controllerAs:"vm"}})}(),function(){var t=angular.module("myApp");t.controller("loginCtrl",["$rootScope","$http","$location","$auth","$window",function(t,e,n,o,a){var i=this;i.user={name:"",password:""},i.message="",i.login=function(){o.login(i.user).then(function(e){t.currentUser=e.data.user,a.localStorage.currentUser=JSON.stringify(e.data.user),n.path("/")})["catch"](function(t){t.error?i.message=t.error:t.data.message?i.message=t.data.message:t.statusText?i.message=t.statusText:i.message=t,console.log(i.message)})}}])}(),function(){var t=angular.module("myApp");t.controller("homeCtrl",["$http","$auth","$location",function(t,e,n){var o=this;o.isAuthenticated=e.isAuthenticated,o.loading=!0,o.message="",o.mails=[],o.open=function(t){n.path("/View/"+t.id)};var a=function(){return console.log("reneww auth token"),t.get("/auth/renew")},i=!0,r=function(t){o.loading=!1,i&&401==t.status?(i=!1,a().then(l)):(o.message=t.data,console.log(t.data))},l=function(){var e=(new Date).getTime();t.get("/api/mail?"+e).then(function(t){o.loading=!1,o.mails=t.data},r)};o.isAuthenticated()&&l()}])}(),function(){var t=angular.module("myApp");t.controller("meCtrl",["$scope","$http","$auth",function(t,e,n){var o=this;o.isAuthenticated=n.isAuthenticated,o.infos=[],o.debugcontent="",o.renew=function(){e.get("/auth/renew").then(a)},o.debug=function(){e.get("/api/mail/debug").then(function(t){o.debugcontent=t.data})};var a=function(){o.infos=[],e.get("/api/config/info").then(function(t){Object.keys(t.data).forEach(function(e){console.log(t.data),o.infos.push({name:e,value:t.data[e]})})})};a()}])}(),function(){var t=angular.module("myApp");t.controller("newCtrl",["$scope","$http","$auth","$location",function(t,e,n,o){var a=this;a.isAuthenticated=n.isAuthenticated,a.loading=!1,a.message="",a.separators=[13,188],a.mail={subject:"",contacts:[],message:""};var i=function(t){a.loading=!1,a.message=t.data,console.log(t.data)};a.send=function(){return console.log(a.mail.contacts),0==a.mail.contacts.length?void(a.message="add email to send to"):(a.loading=!0,a.message="",void e.post("/api/mail",a.mail).then(function(t){a.loading=!1,o.path("/")},i))}}])}(),function(){var t=angular.module("myApp");t.controller("viewCtrl",["$http","$auth","$routeParams","$location",function(t,e,n,o){var a=this;a.isAuthenticated=e.isAuthenticated,a.loading=!0,a.message="",a.mail=[],a.reply=function(){console.log("reply")},a["delete"]=function(){console.log("delete"),t["delete"]("/api/mail/"+a.mail.id+"?token="+a.mail.msgtoken).then(function(t){o.path("/")},l(a["delete"]))};var i=function(){return console.log("reneww auth token"),t.get("/auth/renew")},r=!0,l=function(t){return function(e){a.loading=!1,r&&401==e.status?(r=!1,i().then(t)):(a.message=e.data,console.log(e.data))}},u=function c(){var e=n.id;t.get("/api/mail/"+e).then(function(t){a.loading=!1,console.log(t.data),a.mail=t.data,a.mail.from=a.mail.from.replace(/\<[^\>]*\>/g,""),a.mail.to=a.mail.to.replace(/\<[^\>]*\>/g,"")},l(c))};a.isAuthenticated()&&u()}])}(),function(){angular.module("myApp").directive("mdChips",function(){return{restrict:"E",require:"mdChips",link:function(t,e,n,o){o.onInputBlur=function(){this.inputHasFocus=!1;var t=this.getChipBuffer();""!=t&&(this.appendChip(t),this.resetChipBuffer())}}}})}();